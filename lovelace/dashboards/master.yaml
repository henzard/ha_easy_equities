title: Easy Equities Master Dashboard
path: easy-equities
icon: mdi:wallet
panel: true
cards:
  - type: horizontal-stack
    cards:
      # Portfolio Overview Section (left column)
      - type: vertical-stack
        cards:
          # Header Card
          - type: markdown
            content: |
              ## ðŸ’¼ Portfolio Overview
              Real-time investment tracking

          # Portfolio Summary
          - type: entities
            title: Portfolio Summary
            entities:
              - entity: sensor.portfolio_value
                name: Total Value
                icon: mdi:wallet
                tap_action:
                  action: more-info
              - entity: sensor.portfolio_purchase_value
                name: Total Invested
                icon: mdi:currency-usd
                tap_action:
                  action: more-info
              - entity: sensor.portfolio_profit_loss
                name: Profit/Loss
                icon: mdi:trending-up
                tap_action:
                  action: more-info
              - entity: sensor.portfolio_profit_loss_percent
                name: Return %
                icon: mdi:percent
                tap_action:
                  action: more-info

          # Performance Gauge
          - type: gauge
            entity: sensor.portfolio_profit_loss_percent
            name: Return Percentage
            min: -50
            max: 100
            severity:
              green: 0
              yellow: -10
              red: -20

          # Holdings Count
          - type: entities
            title: Portfolio Stats
            entities:
              - entity: sensor.portfolio_holdings_count
                name: Number of Holdings
                icon: mdi:chart-box
                tap_action:
                  action: more-info

      # Holdings Details Section (middle column)
      - type: vertical-stack
        cards:
          # Header
          - type: markdown
            content: |
              ## ðŸ“ˆ Holdings Details
              Individual investment positions

          # Holdings List
          - type: entities
            title: Current Holdings
            show_header_toggle: false
            # Auto-entities will automatically include all holding sensors
            entities:
              - type: custom:auto-entities
                card:
                  type: entities
                  title: Holdings
                filter:
                  include:
                    - entity_id: sensor.holding_*
                      options:
                        secondary_info: "{{ state_attr(config.entity, 'current_value') }}"
                        tap_action:
                          action: more-info

          # Top Holdings by Value
          - type: markdown
            content: |
              ### ðŸ’Ž Top Holdings
              {% set holdings = states.sensor | selectattr('entity_id', 'match', 'sensor.holding_.*') | list %}
              {% if holdings %}
              {% for holding in holdings | sort(attribute='state', reverse=true) | list[:5] %}
              - **{{ state_attr(holding.entity_id, 'name') | default(holding.name) }}**
                - Value: {{ holding.state | round(2) }} ZAR
                - Shares: {{ state_attr(holding.entity_id, 'shares') | default('N/A') }}
                - Price: {{ state_attr(holding.entity_id, 'current_price') | default('N/A') }}
              {% endfor %}
              {% else %}
              No holdings data available
              {% endif %}

      # Performance & Details Section (right column)
      - type: vertical-stack
        cards:
          # Header
          - type: markdown
            content: |
              ## ðŸ“Š Performance Analysis
              Detailed portfolio metrics

          # Profit/Loss Breakdown
          - type: entities
            title: Performance Metrics
            entities:
              - entity: sensor.portfolio_profit_loss
                name: Total Profit/Loss
                icon: mdi:trending-up
                tap_action:
                  action: more-info
              - entity: sensor.portfolio_profit_loss_percent
                name: Return Percentage
                icon: mdi:percent
                tap_action:
                  action: more-info

          # Portfolio Value Chart
          - type: history-graph
            title: Portfolio Value Over Time
            entities:
              - entity: sensor.portfolio_value
                name: Portfolio Value
            hours_to_show: 168
            refresh_interval: 300

          # Quick Stats
          - type: markdown
            content: |
              ### ðŸ“ˆ Quick Stats
              {% set portfolio_value = states('sensor.portfolio_value') | float(0) %}
              {% set purchase_value = states('sensor.portfolio_purchase_value') | float(0) %}
              {% set profit_loss = states('sensor.portfolio_profit_loss') | float(0) %}
              {% set holdings_count = states('sensor.portfolio_holdings_count') | int(0) %}
              
              - **Average Holding Value:** {{ (portfolio_value / holdings_count) | round(2) if holdings_count > 0 else 0 }} ZAR
              - **Total Invested:** {{ purchase_value | round(2) }} ZAR
              - **Current Value:** {{ portfolio_value | round(2) }} ZAR
              - **Number of Positions:** {{ holdings_count }}
