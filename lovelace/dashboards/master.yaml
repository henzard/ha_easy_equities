title: Easy Equities Master Dashboard
path: easy-equities
icon: mdi:wallet
panel: true
# NOTE: This dashboard uses auto-entities for automatic sensor discovery
# Entity IDs follow pattern: sensor.{entry_id}_{sensor_type}
# Example: sensor.easy_equities_portfolio_value
# Replace 'easy_equities' with your actual integration entry ID
cards:
  - type: horizontal-stack
    cards:
      # Portfolio Overview Section (left column)
      - type: vertical-stack
        cards:
          # Header Card
          - type: markdown
            content: |
              ## ðŸ’¼ Portfolio Overview
              Real-time investment tracking

          # Portfolio Summary
          # Note: Replace 'easy_equities' with your actual integration entry ID
          # Entity IDs follow pattern: sensor.{entry_id}_portfolio_value
          - type: entities
            title: Portfolio Summary
            entities:
              - type: custom:auto-entities
                card:
                  type: entities
                  title: Portfolio Summary
                filter:
                  include:
                    - entity_id: sensor.*_portfolio_value
                      options:
                        name: Total Value
                        icon: mdi:wallet
                        tap_action:
                          action: more-info
                    - entity_id: sensor.*_portfolio_purchase_value
                      options:
                        name: Total Invested
                        icon: mdi:currency-usd
                        tap_action:
                          action: more-info
                    - entity_id: sensor.*_portfolio_profit_loss
                      options:
                        name: Profit/Loss
                        icon: mdi:trending-up
                        tap_action:
                          action: more-info
                    - entity_id: sensor.*_portfolio_profit_loss_percent
                      options:
                        name: Return %
                        icon: mdi:percent
                        tap_action:
                          action: more-info

          # Performance Gauge
          # Note: Replace with your actual entity ID (sensor.{entry_id}_portfolio_profit_loss_percent)
          - type: gauge
            entity: sensor.easy_equities_portfolio_profit_loss_percent
            name: Return Percentage
            min: -50
            max: 100
            severity:
              green: 0
              yellow: -10
              red: -20

          # Holdings Count
          - type: entities
            title: Portfolio Stats
            entities:
              - type: custom:auto-entities
                card:
                  type: entities
                  title: Portfolio Stats
                filter:
                  include:
                    - entity_id: sensor.*_portfolio_holdings_count
                      options:
                        name: Number of Holdings
                        icon: mdi:chart-box
                        tap_action:
                          action: more-info

      # Holdings Details Section (middle column)
      - type: vertical-stack
        cards:
          # Header
          - type: markdown
            content: |
              ## ðŸ“ˆ Holdings Details
              Individual investment positions

          # Holdings List
          - type: entities
            title: Current Holdings
            show_header_toggle: false
            # Auto-entities will automatically include all holding sensors
            # Entity pattern: sensor.{entry_id}_holding_{contract_code} or sensor.{entry_id}_holding_{account_id}_{contract_code}
            entities:
              - type: custom:auto-entities
                card:
                  type: entities
                  title: Holdings
                filter:
                  include:
                    - entity_id: sensor.*_holding_*
                      options:
                        secondary_info: "{{ state_attr(config.entity, 'current_value') }}"
                        tap_action:
                          action: more-info

          # Top Holdings by Value
          - type: markdown
            content: |
              ### ðŸ’Ž Top Holdings
              {% set holdings = states.sensor | selectattr('entity_id', 'match', 'sensor.*_holding_.*') | list %}
              {% if holdings %}
              {% for holding in holdings | sort(attribute='state', reverse=true) | list[:5] %}
              - **{{ state_attr(holding.entity_id, 'name') | default(holding.name) }}**
                - Value: {{ holding.state | round(2) }} {{ state_attr(holding.entity_id, 'currency') | default(holding.attributes.unit_of_measurement) | default('ZAR') }}
                - Shares: {{ state_attr(holding.entity_id, 'shares') | default('N/A') }}
                - Price: {{ state_attr(holding.entity_id, 'current_price') | default('N/A') }}
                {% if state_attr(holding.entity_id, 'account_name') %}
                - Account: {{ state_attr(holding.entity_id, 'account_name') }}
                {% endif %}
              {% endfor %}
              {% else %}
              No holdings data available
              {% endif %}

      # Performance & Details Section (right column)
      - type: vertical-stack
        cards:
          # Header
          - type: markdown
            content: |
              ## ðŸ“Š Performance Analysis
              Detailed portfolio metrics

          # Profit/Loss Breakdown
          - type: entities
            title: Performance Metrics
            entities:
              - type: custom:auto-entities
                card:
                  type: entities
                  title: Performance Metrics
                filter:
                  include:
                    - entity_id: sensor.*_portfolio_profit_loss
                      options:
                        name: Total Profit/Loss
                        icon: mdi:trending-up
                        tap_action:
                          action: more-info
                    - entity_id: sensor.*_portfolio_profit_loss_percent
                      options:
                        name: Return Percentage
                        icon: mdi:percent
                        tap_action:
                          action: more-info

          # Portfolio Value Chart
          # Note: Replace with your actual entity ID (sensor.{entry_id}_portfolio_value)
          - type: history-graph
            title: Portfolio Value Over Time
            entities:
              - entity: sensor.easy_equities_portfolio_value
                name: Portfolio Value
            hours_to_show: 168
            refresh_interval: 300

          # Quick Stats
          # Note: Uses auto-discovery to find portfolio sensors dynamically
          - type: markdown
            content: |
              ### ðŸ“ˆ Quick Stats
              {% set portfolio_sensors = states.sensor | selectattr('entity_id', 'match', 'sensor.*_portfolio_value') | list %}
              {% set purchase_sensors = states.sensor | selectattr('entity_id', 'match', 'sensor.*_portfolio_purchase_value') | list %}
              {% set profit_sensors = states.sensor | selectattr('entity_id', 'match', 'sensor.*_portfolio_profit_loss') | list %}
              {% set holdings_sensors = states.sensor | selectattr('entity_id', 'match', 'sensor.*_portfolio_holdings_count') | list %}
              
              {% set portfolio_value = portfolio_sensors[0].state | float(0) if portfolio_sensors else 0 %}
              {% set purchase_value = purchase_sensors[0].state | float(0) if purchase_sensors else 0 %}
              {% set profit_loss = profit_sensors[0].state | float(0) if profit_sensors else 0 %}
              {% set holdings_count = holdings_sensors[0].state | int(0) if holdings_sensors else 0 %}
              
              - **Average Holding Value:** {{ (portfolio_value / holdings_count) | round(2) if holdings_count > 0 else 0 }} ZAR
              - **Total Invested:** {{ purchase_value | round(2) }} ZAR
              - **Current Value:** {{ portfolio_value | round(2) }} ZAR
              - **Number of Positions:** {{ holdings_count }}
